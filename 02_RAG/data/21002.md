# Zod 4 릴리즈 


* **스키마 선언 및 유효성 검사 라이브러리**인 Zod의 버전 4 릴리즈. 주요 성능 향상과 장기 요청된 기능을 포함해 안정버전 출시
* **속도와 번들 크기**에서 큰 개선이 이루어졌으며, 새로운 미니 버전(v4-mini)은 번들 크기를 대폭 줄임
* 새로운 **메타데이터 레지스트리**와 **JSON Schema 변환**, 그리고 재귀 타입 추론 기능이 추가됨
* **에러 메시지 커스터마이즈**와 다국어 로케일 시스템 등 개발자 경험이 강화됨
* 향후 라이브러리 구축에 활용할 수 있는 **코어 서브패키지** 도입 등으로 확장성이 더욱 높아짐

---

Zod 4 소개
--------

### 주요 출시에 대한 안내

* 1년간의 활발한 개발을 거쳐 **Zod 4**가 안정 버전으로 출시됨
* **Clerk**의 OSS Fellowship 지원을 받아 개발 진행됨
* 현재 Zod 3와 병행 배포되어, Zod 4로의 점진적 마이그레이션이 쉬워짐
* 일부 파괴적 변경점에 대한 상세 안내는 [Migration guide](/v4/changelog)에서 확인 가능함

### 성장 배경

* 2021년 출시된 Zod 3 대비 Zod 4는 GitHub 스타 수와 주간 다운로드 수가 기하급수적으로 성장함
* **Zod 4는 훨씬 빠르고, 슬림하며, 타입스크립트 컴파일러 효율이 개선됨**
* **장기적으로 요청이 많았던 9가지 주요 이슈**가 해결됨

### 벤치마크 및 성능

* **속도 향상**:
  + 문자열 파싱: **14.71배 빠른 결과**
  + 배열 파싱: **7.43배 빠름**
  + 객체 파싱(safeParse): **6.5배 빠름**
* 리포에서 직접 벤치마크를 수행할 수 있는 스크립트 제공
* 개선된 제네릭 구조로 인해 `.extend()`, `.omit()` 등의 메서드 체이닝 시 **컴파일 성능이 10배 향상됨**
* 대규모 스키마 및 코드베이스에서 TypeScript 컴파일 속도가 크게 개선됨

### 번들 크기와 Zod Mini

* 기본 번들 크기가 **57% 감소**해, v4는 v3 대비 2.3배 작은 크기 제공
* **zod/v4-mini**는 함수 기반의 트리-쉐이크 가능한 API 제공, 번들 크기를 **85%까지 줄임**
* core와 v4-mini의 API 차이는 공식 문서에서 상세히 정리됨
* 번들러에서 사용하지 않는 메서드를 쉽게 제거할 수 있도록 구조 설계됨

### 메타데이터 레지스트리와 JSON Schema 지원

* **typed metadata**를 스키마에 강타입으로 등록 및 관리 가능
* 글로벌 레지스트리(`z.globalRegistry`)에서 JSON Schema 호환 메타데이터 처리 및 자동 포함 기능 제공
* `.meta()`, `.describe()`를 통해 스키마 문서화 용이
* `.toJSONSchema()`로 **스키마를 JSON Schema 형식으로 변환** 가능, 메타데이터 자동 반영

### 재귀 타입 자동 추론

* 재귀 객체 타입과 상호 재귀 타입을 별도의 타입 캐스팅 없이 자연스럽게 정의 및 추론 가능
* 기존 Zod 3 패턴보다 사용성이 크게 향상됨
* 재귀·상호재귀 타입에서도 **모든 스키마 메서드 기능 사용 가능**

### 파일 타입 및 검증 기능

* 새로운 `file()` 타입으로 `File` 인스턴스 검증 가능
* **파일 크기(`min`, `max`)와 MIME 타입 등** 다양한 파일 제약조건 검증 제공

### 에러 메시지 및 로케일 시스템

* 글로벌 로케일 API(`z.locales`)로 **에러 메시지의 다국어 지원** 가능
* 공식 `z.prettifyError` 함수로 사용자 친화적인 에러 포맷팅 지원

### 포맷 함수 및 템플릿 리터럴

* 기존 문자열 포맷(`email` 등)은 상위 레벨 함수로 승격되어 가독성과 트리 쉐이킹이 개선됨
* 다양한 **이메일 정규식** 옵션 제공, 다양한 검증 요구 사항 충족
* **템플릿 리터럴 타입 지원**: 타입 시스템에서 표현 가능한 문자열 패턴 및 복잡한 조합 쉽게 구현

### 새로 추가된 숫자 및 bigint 포맷

* 고정 폭의 **정수, 부동소수점 타입** (`int32`, `uint64` 등) 지원
* 안전한 범위 내에서 자동으로 **최소/최대 제약조건**이 추가된 스키마 생성 가능

### z.stringbool 소개

* 문자열 기반 불리언 파싱(`yes`, `no` 등) 가능, 환경변수 스타일 파싱도 지원
* truthy/falsy 값은 커스터마이즈 가능

### 에러 커스터마이즈 API 통합

* **단일화된 `error` 파라미터**를 통해 에러 메시지와 처리 로직 구조 정돈
* 기존의 여러 에러 관련 API (`message`, `invalid_type_error`, `errorMap`)는 deprecated

### 기타 핵심 개선점

* **판별 유니온(discriminated unions)** 이 다양한 스키마, 중첩, 조합을 지원
* `.literal()`이 동시에 여러 값 허용
* `.refine()` 등 커스텀 검증이 더욱 직관적으로 통합됨
* transform 관련 `.overwrite()`로 변환 타입 변경 없이 후처리 가능

### 라이브러리 확장성 및 새로운 코어

* **zod/v4/core**로 핵심 기능이 별도 서브패키지로 분리, 다양한 라이브러리·플랫폼 통합/확장 가능
* 라이브러리 제작자를 위한 가이드 문서와 확장 예시 제공

### 마무리

* Zod 4는 **타입 안정성, 성능, 확장성, 개발자 경험** 모두를 크게 개선한 자료 검증 라이브러리로 자리 잡음
* 향후 추가적인 설계 포스트 및 업데이트가 예고됨
* 기존 사용자와 라이브러리 제작자 모두를 위한 폭넓은 지원 준비됨

행복한 파싱 경험 제공  
— Colin McDonnell [@colinhacks](https://x.com/colinhacks)


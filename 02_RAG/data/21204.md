# Amazon Web Services의 시스템 정확성 실천 사례


* **Amazon Web Services(AWS)** 는 서비스의 **정확성**을 핵심 가치로 두고 여러 형태의 형식적 방법론을 개발 프로세스에 통합함
* TLA+와 P 언어 등 **형식 명세 도구**를 통해 미묘한 버그를 조기에 발견하고, 대담한 최적화에도 신뢰성 확보 가능함
* AWS는 **경량화된 형식 방법론**으로 속성 기반 테스트·결정적 시뮬레이션·지속적 퍼징 등도 폭넓게 운용함
* Fault Injection Service 같은 **실패 주입 도구**를 통해 장애 발생 상황까지 포함한 신뢰성 검증을 자동화함
* **교육적 장벽**과 도구의 복잡성이 여전하지만, AI와 자동화 도구의 확산이 보급 확대에 기여할 전망임

---

AWS의 시스템 정확성 보장 전략
------------------

Amazon Web Services(AWS)는 고객이 완전히 신뢰할 수 있는 **신뢰성 높은 서비스** 제공을 목표로 함  
이를 위해 **보안성, 내구성, 무결성, 가용성** 기준 유지를 추구하며, 그 중심에 **시스템 정확성** 개념을 배치함

2015년 *Communications of the ACM*에 소개된 AWS의 형식적 방법론 적용 사례 이후, 해당 접근법은 핵심 서비스의 성공적 운용에 중요한 역할을 해옴

중심에는 Leslie Lamport가 개발한 TLA+라는 **형식 명세 언어**가 있음  
AWS의 TLA+ 도입 경험은 개발 초기 단계에서 기존 테스트로는 잡히지 않는 미세한 버그를 파악할 수 있게 해주었음  
또한, 과감한 **성능 최적화**를 진행할 때도 형식적 검증을 통해 안정성과 신뢰성을 확보할 수 있었음

15년 전 AWS는 빌드 시점 단위 테스트, 제한된 통합 테스트 등 기본 수준에 머물렀지만, 이후로 형식적 접근과 준형식적 방법을 포괄적으로 도입함  
이러한 변화는 정확성뿐 아니라 고수준 및 저수준 최적화 검증·개발 속도 향상·비용 절감에 기여함

AWS에서는 기존의 **정형 증명, 모델 검증**뿐만 아니라 **속성 기반 테스트, 퍼징, 런타임 모니터링** 등도 형식적 방법론의 범주로 수용함

P 프로그래밍 언어의 등장
--------------

초기에는 TLA+가 강력한 추상적 기술이라는 장점이 있었으나, 수많은 개발자 입장에서는 수학적 표기법 사용의 진입장벽이 컸음  
그래서 AWS는 개발자가 익숙한 상태 기계 기반 접근을 제공하는 **P 언어**를 도입함

P 언어는 분산 시스템 설계 및 분석을 위해 상태 기계 모델링 방식을 제공함  
마이크로서비스 기반 SOA 구조를 사용하는 Amazon 개발자들에게 친숙한 개념임  
2019년부터 AWS에서 개발 및 전략적 오픈소스 프로젝트로 관리 중임  
**Amazon S3, EBS, DynamoDB, Aurora, EC2, IoT** 등 주요 서비스팀이 P를 활용해 시스템 설계의 정확성 검증을 수행함

S3를 강력한 **read-after-write 일관성**으로 전환할 때, P로 프로토콜을 모델링 및 검증해, 설계 초기 단계에서 버그를 제거하고 최적화 사항도 안정적으로 반영함

2023년 AWS P 팀은 **PObserve** 툴을 개발해, 테스트와 실제 운영 환경 모두에서 분산 시스템의 정확성을 검증 가능하게 함  
PObserve는 실행 로그를 추출해, 명세에 따라 올바른 동작이 이뤄졌는지 사후 검증이 가능하며, 설계 단계 명세와 실제 코드 구현을 효과적으로 연계해줌

경량 형식 방법론 확대
------------

### 속성 기반 테스트

가장 대표적인 경량 형식 기법은 **속성 기반 테스트**임  
예를 들어 S3의 ShardStore 개발팀은 개발 주기의 전 과정에서 속성 기반 테스트·코드 커버리지 기반 퍼징·실패주입·카운터 예제 최소화 등을 복합 사용함  
이 방식은 개발자가 직접 작성하는 정확성 명세와 연동되고, 문제점 디버깅 효율도 크게 향상됨

### 결정적 시뮬레이션

**결정적 시뮬레이션** 테스트는 단일 스레드 시뮬레이터에서 분산 시스템을 실행, 모든 난수 요소(스케줄링, 타이밍, 메시지 순서 등) 제어가 가능함  
특정 오류 및 성공 시나리오에 대한 테스트, 버그 유발 순서 조정, 퍼징 확장 등 다양한 방식으로 적용됨  
이로 인해 시스템의 지연, 실패 등 동작 검증을 빌드 단계에서 일찍 수행하고, 테스트 범위가 확대됨  
AWS는 이러한 빌드 타임 테스트 코드를 shuttle, turmoil 오픈소스 프로젝트로 공개함

### 지속적 퍼징

지속적 퍼징, 특히 코드 커버리지 기반 대규모 입력 생성은 통합테스트 단계에서 시스템 정확성 검증에 효과적임  
예를 들어 Aurora Limitless Database 개발시 SQL 쿼리와 트랜잭션을 퍼징해, 파티셔닝 논리의 정확성을 대량의 무작위 스키마·데이터셋·쿼리를 생성해 검증함  
결과는 non-sharded 엔진의 동작 또는 SQLancer 등의 방식과 비교함  
퍼징과 실패 주입 결합으로 **원자성, 일관성, 격리성** 등 데이터베이스의 핵심 속성을 검증함  
자동 생성 트랜잭션, 격리성 등 일부 속성은 실행 이력 기반 사후 검증을 통해 보장함

Fault Injection Service를 통한 장애 주입
---------------------------------

2021년 AWS는 **Fault Injection Service(FIS)** 를 출시해 고객도 API 오류, I/O 중단, 인스턴스 장애 등 다양한 결함 시나리오를 실제 또는 테스트 환경에 빠르게 실험할 수 있도록 함  
이를 통해 아키텍처의 가용성 확보 및 장애 복원력 점검, 오류 케이스의 높은 버그 밀도 차이 해소, 가능성 높은 중대한 문제 사전 발견 등의 효과가 있음

FIS는 AWS 고객은 물론 Amazon 내부에서도 광범위하게 사용되고, 예를 들어 Prime Day 준비 과정에서만 733건의 실험이 진행됨

오류 주입은 형식 명세와 결합하면 더 효과적임  
예상 동작을 형식 명세로 작성 후, 실제 결함 유발 결과를 이에 대조해 기존의 단순 로그·지표 점검보다 더 많은 오류를 잡을 수 있음

메타안정성과 시스템 발현 동작
----------------

분산 시스템에서 지나친 부하/캐시 소진 등 유발로 ‘자체적으로 복구 불가능’한 비정상(메타안정적) 상태에 빠지는 사례가 증가함  
이 상태에선 단순 부하 감소만으로는 정상 복구되지 않고, 통상적인 오류 케이스보다 대응이 까다로움  
대부분의 재시도-타임아웃 로직도 이런 현상의 원인이 됨

기존 형식 명세는 안전성과 진행성에 초점 두지만, 메타안정성은 그 이외의 다양한 발현 동작까지 고려해야 함  
AWS는 TLA+, P 등의 명세 모델을 바탕으로 **이산 이벤트 시뮬레이션**을 진행, 성능 SLA 달성 가능성·지연 분포 산출 등 확률적 특성까지 체계적으로 분석함

형식 증명의 필요성
----------

일부 **보안 경계(권한·가상화 등)** 에서는 단순 테스트 이상의, 수학적 수준의 증명이 필수적임

예를 들어 2023년 AWS가 도입한 Cedar 권한 정책 언어는 **Dafny** 기반으로 자동 증명과 형식적 검증에 최적화되며, 공개 코드와 정정 절차를 통해 전체 사용자도 직접 검증이 가능함  
또 Firecracker VMM의 보안 경계(key property)는 Kani 등의 **Rust 코드 분석 도구**로 증명 작업 진행됨

이처럼 형식 모델과 명세를 다양한 시점(설계, 구현, 시행, 증명)에 폭넓게 활용함으로써 소프트웨어 정확성 확보와 기업·고객 가치 확대에 활용함

정확성을 넘어선 추가 효과
--------------

형식 방법론은 **신뢰성과 성능 개선** 모두에 중대한 역할을 함  
예를 들어 Aurora의 commit 프로토콜을 P와 TLA+로 검증, 네트워크 소요 라운드트립을 줄이는 동시에 안전성도 보장함  
RSA 암호화 알고리듬의 ARM Graviton 2 최적화 시, HOL Light에서 변환의 수학적 정확성을 증명해 **성능·인프라 비용 동시 개선**이라는 실질 효과를 거둠

미래의 도전과 기회
----------

15년간 AWS는 형식/준형식 방법론의 산업 적용을 크게 확대했으나, 학습 곡선, 전문가 필요성, 도구의 학술적 특성 등 실질적 **도입 장애** 문제가 상존함  
속성 기반 테스트, 결정적 시뮬레이션 등도 많은 개발자에겐 여전히 생소함  
교육상의 진입장벽이 학부 과정부터 존재하므로, 도구·방법론의 보급과 실무 적용이 더디게 진행됨  
메타안정성 등 대규모 시스템의 발현적 특성도 연구 초기 단계임

향후 **AI/대형 언어 모델**이 형식적 모델·명세 작성을 지원해, 실무자 접근성을 단기간 내 획기적으로 높여줄 것으로 기대됨

결론
--

견고하고 안전한 소프트웨어 구축에는 다양한 시스템 정확성 확보 수단이 필요함  
AWS는 표준 테스트 기법 이외에도 모델체킹, 퍼징, 속성 기반 테스트, 장애 주입 테스트, 결정적/이벤트 기반 시뮬레이션, 실행 이력 검증 등을 포괄적으로 도입함  
형식 명세와 방법론은 AWS의 개발 프로세스에서 중요한 시험 오라클 역할을 하며, 이미 실질적·경제적 효과 검증을 통해 투자 영역 중 하나로 자리잡고 있음


# 당신에겐 웹소켓이 필요 없을 수도 있어요


* WebSocket은 실시간 통신에 유용하지만, 항상 필요한 것은 아니며 HTTP 기반 대안이 더 간단하고 안정적일 수 있음
* 트랜잭션 처리, 연결 관리, 서버 복잡성 등에서 WebSocket은 과도한 오버헤드를 유발할 수 있음
* HTTP Streaming과 라이브러리(eventkit)를 활용하면 WebSocket 없이도 실시간 동기화와 이벤트 처리가 가능함

### WebSocket이란 무엇인가

* WebSocket은 클라이언트와 서버 간에 지속적인 양방향 통신 채널을 여는 기술임
* HTTP를 통해 연결을 시작하지만, 이후에는 별도의 프로토콜로 통신이 이루어짐
* 실시간 애플리케이션 구현에 자주 사용되며, 쌍방향 통신이 가능하다는 점에서 유용함

### WebSocket 메시지는 트랜잭션 방식이 아님

* WebSocket은 요청과 응답 간의 직접적인 연관을 보장하지 않음
* 상태 변경 명령과 그 결과 메시지가 동일한 스트림에서 섞여 도착할 수 있음
* 예를 들어, 하나의 클라이언트가 상태를 변경하고 에러가 발생해도, 어떤 명령에 대한 에러인지 알기 어려움
* 해결 방법은 `requestId`를 포함시켜 명령과 응답을 연결하는 방식이지만, 이는 복잡성과 관리 비용을 증가시킴
* HTTP를 활용한 트랜잭션 방식으로 명령을 보내고, WebSocket은 상태 변경 방송에만 사용하는 방식이 더 단순함
* 전송 측은 HTTP 요청으로, 수신 측은 WebSocket 또는 다른 스트리밍 방식으로 분리 가능함

### WebSocket 연결 생명주기 관리의 어려움

* WebSocket을 사용할 경우 연결의 시작, 종료, 에러, 재연결 등을 직접 처리해야 함
* 브라우저에서의 기본 처리 예시에는 연결 오픈, 메시지 수신, 에러 발생, 연결 종료 이벤트 핸들링이 포함됨
* 재연결 로직, 메시지 버퍼링, 지수적 백오프 등 추가 로직이 필요함
* 반면 HTTP는 요청 단위로 시작과 종료가 명확하여 구현이 간단함
* 복잡한 생명주기 관리는 WebSocket을 사용할 이유가 확실할 때만 정당화됨

### 서버 코드 복잡도 증가

* WebSocket은 HTTP 업그레이드 요청을 처리해야 하며, 이는 추가적인 핸드셰이크 로직을 요구함
* `Sec-WebSocket-Key` 같은 특수 헤더를 검증하고, 응답 헤더를 적절히 반환해야 함
* WebSocket 연결 후에는 지속적인 메시지 수신 및 송신 상태를 유지해야 하며, 부분 프레임 처리와 같은 문제도 발생 가능함
* HTTP만을 사용할 경우보다 디버깅 및 오류 처리 난이도가 높아짐
* 프레임워크가 일부 과정을 추상화하지만, 기본 복잡성은 여전히 존재함

### 대안: HTTP Streaming

* HTTP는 원래 스트리밍을 지원하는 프로토콜로, 전체 파일이 아닌 데이터 스트림을 실시간으로 전송 가능함
* 기존 WebSocket의 수신 측 기능만 HTTP 스트리밍으로 대체 가능함
* 비동기 제너레이터를 사용해 상태 업데이트를 스트림 형태로 처리 가능함
* 서버측 흐름
  + 상태 업데이트는 명령 처리 함수에서 수행됨
  + 연결된 클라이언트들은 제너레이터를 통해 새로운 값이 나올 때마다 전달받음
  + 상태 변경 명령은 HTTP POST를 통해 전송되고, 실시간 스트림은 GET 요청으로 구독함
* 클라이언트 측 흐름
  + Fetch API와 Stream Reader를 통해 실시간 데이터 수신
  + 텍스트 디코딩 후 UI 업데이트 수행
* 이 구조로 WebSocket 없이도 실시간 상태 동기화 구현 가능함

### 보너스: eventkit 라이브러리 소개

* `eventkit`은 비동기 스트림을 쉽게 구성하고 관찰할 수 있도록 해주는 라이브러리임
* RxJS와 유사하지만, 부작용 관리가 개선되었고 제너레이터 기반으로 설계됨
* 상태 업데이트를 스트림에 푸시하면, 클라이언트에서 이를 실시간으로 수신 가능함
* `Stream` 및 `AsyncObservable`을 통해 서버/클라이언트 양쪽에서 간단하게 구현 가능함
* 서버 측 eventkit 활용
  + 상태 변경을 Stream에 push하고, 클라이언트는 해당 스트림을 구독
* 클라이언트 측 eventkit 활용
  + 스트림 데이터를 받아 디코딩 후 UI 업데이트 수행
* 공식 GitHub 저장소와 HTTP Streaming 가이드도 제공되고 있음

> GitHub: [<https://github.com/hntrl/eventkit>](https://github.com/hntrl/eventkit)


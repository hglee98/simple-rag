# 과도하게 설계된 앵커 링크(Anchor Link)


* 앵커 링크는 단순히 버튼 클릭 → 제목으로 스크롤이라는 구조지만, 실제 구현 시 문제가 발생함
* **하단에 위치한 제목은 뷰포트 상단으로 정확히 스크롤되지 않음**, 이로 인해 UX 저하 발생
* 이를 해결하기 위해 다양한 접근을 시도하며, 점점 더 정교하고 복잡한 방식으로 발전시킴

단순 해결: 패딩 추가
------------

* 하단 제목이 스크롤에 잡히도록 여백을 추가하는 방식
* 델타를 계산해 padding 추가하면 해결 가능
* 하지만 디자인 팀에서 **불필요한 여백**을 꺼릴 수 있음

실용적 해결: 트리거 라인 이동
-----------------

* 트리거 라인을 뷰포트 하단 쪽으로 이동시켜 하단 제목이 닿도록 조정
* 문제는 제목이 뷰포트 맨 아래에 위치하게 되어 **가독성이 떨어짐**

개선안: 가상 트리거 포인트 생성
------------------

* **실제 제목 위치는 그대로 두고**, 트리거 발생 위치만 위쪽으로 **이동한 가상 위치**를 생성
* 각 제목마다 다른 조정을 적용할 수 있는 **유연성 확보**
* 하지만 첫 번째 제목은 너무 위로 이동되어 새로운 문제가 발생함 → **개별 조정이 필요**

더 나은 방식: 트리거 위치 비례 이동
---------------------

* 모든 트리거를 동일하게 이동하지 않고, **첫 제목은 그대로**, 마지막 제목은 최대 이동
* 중간 제목은 위치에 따라 **비례 이동**함
* **제목 순서 유지** 및 **스크롤 도달 가능성 보장**이라는 조건을 충족
* 이 방식은 **단순하고 실용적**, 대부분의 경우 적절히 작동

고급 접근: 커스텀 매핑 함수로 최적화
---------------------

* 트리거 위치를 임의로 25% 위치에 두었기 때문에, **가상 위치가 원래 위치에서 너무 벗어날 수 있음**
* 이를 해결하기 위해 **MSE(Mean Squared Error)** 를 활용한 최적화 접근을 도입

### 손실 함수 구성

* **Anchor Penalty**: 가상 제목 위치가 원래 위치에서 벗어난 정도
* **Section Penalty**: 섹션 간 거리(스크롤 길이)의 변화 정도
* 두 값을 가중치로 조절해 최적의 트리거 위치를 도출

### 제약 조건

* 페이지 범위 내 유지
* 첫 번째 제목은 위로 이동하지 않음
* 제목 순서 보존

인사이트: 단순 비례 이동의 한계
------------------

* 매우 긴 페이지(ex. 성경 전체)에서는 **전체에 걸쳐 작은 이동을 누적 적용**해야 하는 비효율 발생
* 페이지 길이가 길수록 오류가 커지고, UX에 악영향 가능성 있음

최종 해결: 스무스스텝 기반 가변 매핑 함수
------------------------

* 각 제목의 위치를 0~1 사이의 값으로 정규화하고, 이를 기반으로 **조정 비율 계산**
* **Smoothstep 함수(S(x) = 3x² - 2x³)** 를 이용해 부드러운 전이 구현
* 조정 시작 위치 `a`를 설정하여 특정 위치까지는 이동하지 않고 이후부터 부드럽게 상승
  + 예: `a = 0.4`이면 상위 40% 제목은 이동 없음, 하위 60%는 점진적 조정
* 결과적으로, 상단 제목은 원래 위치 유지, 하단 제목은 최대 조정 적용 → **자연스러운 UX 제공**

검증 및 마무리
--------

* 최종 구현은 **설계적 정교함과 실용성의 균형**을 갖춘 솔루션
* 물론, 디자이너 피드백은 “...그냥 잘 작동하면 좋겠음”일 수 있음
* 하지만 적어도 **이 블로그 글은 영원히 기억될 정교한 엔지니어링의 기록**으로 남게 됨

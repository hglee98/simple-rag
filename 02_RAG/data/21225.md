# 신용카드 단말기에서 root shell 획득


* **Worldline Yomani XR 신용카드 단말기**의 보안 연구를 위해 리버스 엔지니어링을 시도함
* 내부 분해 과정에서 **물리적 침입 감지** 기능은 잘 구현되어 있으나, 소프트웨어적으로 **루트 셸이 외부 시리얼 포트에 노출**되는 문제가 발견됨
* 메모리 언납, 펌웨어 추출 및 분석을 통해 **리눅스 3.6 커널 기반의 시스템** 구조와 매우 오래된 구성요소들을 확인함
* **시리얼 콘솔 포트**를 통해 장치를 분해하지 않고도 쉽게 루트 권한 획득 및 악성 코드 설치가 가능함을 입증함
* 전체 결제 및 인증 관련 중요한 작업은 **별도의 보안 프로세서**에서 이루어져, 실제로 중요한 데이터 노출 위험은 크지 않음

---

프로젝트 개요
-------

* 본 프로젝트는 **결제 단말기**의 보안 연구 목적으로 Worldline Yomani XR 모델을 역분석하는 과정을 중심으로 함
* 스위스 전역에서 널리 사용되는 이 모델은 현재 단종이지만 여러 대형 소매점과 소규모 매장에서 여전히 사용 중임

첫 관찰 및 하드웨어 분해
--------------

* UI 탐색, 포트 스캔 등 기본적인 조사 이후 하드웨어 분해를 시작함
* 여러 PCB, 소재가 잘 구성된 하우징, 커스텀 ASIC 기반의 듀얼 코어 Arm 프로세서 등, 상당한 하드웨어 보안성이 관찰됨
* 주요 SoC는 **Samoa II**란 코드명의 전용 ASIC이며, 외부에 플래시와 RAM이 탑재됨

침입 감지 및 위변조 보호
--------------

* 하우징을 열지 않고도 **압력 감지식 보드 연결**(Zebra strip) 불량이나 나사 풀림만으로 침입 이벤트가 감지됨
* 배터리를 통해 전원 차단 상황에서도 감지가 유지됨
* 주요 PCB에 **지그재그 동선(트레이스)** , 카드 리더에 감싼 **플렉시블 PCB** 등이 손상 시 침입 탐지됨
* 잠시 해체 후 재조립 시, **침입 감지**로 인해 장치는 빨간 "TAMPER DETECTED" 화면만 표시하며 외부 입력에 응답하지 않음

칩-오프 펌웨어 추출
-----------

* **온보드 플래시**를 디솔더링하고 직접 연결해 펌웨어를 추출함
* 데이터는 암호화되지 않았으나, 독특한 ECC 구조와 YAFFS2 파일 시스템의 메타데이터 배치가 확인됨
* 파일시스템 리더를 구현하여 전체 파일 목록을 확보함
* 시스템은 **2010년 버전 Buildroot 기반 3.6 커널** 사용, uClibc와 busybox, 오래된 라이브러리들이 다수 존재함

우연히 루트 셸 발견 과정
--------------

* 펌웨어 분석 후, 플래시를 다시 연결하고 시리얼 콘솔 회선을 찾아 논리 분석기로 신호를 잡음
* 부트 로그와 함께 **로그인 프롬프트**가 노출됨
* "root" 입력 시 암호 없이 **즉시 루트 셸 진입**이 가능함
* 실제로 이 시리얼 포트는 **외부에서 커버만 열면 바로 접근** 가능함
* 공격자는 단말기를 분해하지 않고도 신속하게 접속, 악성코드 주입 등이 가능

얼마나 심각한 문제인가?
-------------

* 부트 및 시스템 구성 분석 결과, 리눅스는 네트워크, 업데이트, 일부 비즈니스 로직만 담당함
* 카드 결제, PIN 입력, 디스플레이 등 모든 **보안 관련 기능은 별도의 mp1 프로세서**가 관리함
* 리눅스(mp2)는 항상 부팅되며, 이후 **서명·암호화된 이미지**가 보안 부트로더에 의해 보안 코어로 적재됨
* 내부적으로 보안 코어 보호는 멀쩡히 동작 중이며, **보안 핵심 데이터는 루트 셸 노출로 유출되지 않음**

공개 및 보고 일정
----------

* 2024년 11월 14일: 루트 셸 발견
* 2024년 11월 15일: 제조사에 90일 공개 예정과 함께 알림
* 2024년 11월 18일: 제조사로부터 보고 확인 회신
* 2025년 6월 1일: 프로젝트 공개

결론
--

* 외부 시리얼 포트를 통한 **루트 셸 노출**은 명백한 불필요 공격면이자 엔지니어링 실수임
* 다만 보안 프로세서 분리 설계 덕분에, 실질적인 **결제 정보 노출 위험은 낮음**
* 루트 로그인 허용이 프로덕션 펌웨어에 실수로 적용됐거나, 버전에 따라 다를 수 있음
* 연구 과정에서 일부 장치는 루트 로그인 기능이 아예 비활성화된 것도 존재함
* 내부적으로 해당 문제는 이미 인지 및 수정됐을 가능성이 있음

이 프로젝트는 여러 흥미로운 결과를 남겼으며, 펌웨어 심층 탐색의 가치도 다시금 보여줌

